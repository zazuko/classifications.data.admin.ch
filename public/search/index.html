<!DOCTYPE html>
<html>
 <head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="/css/admin.css">
   <link rel="stylesheet" href="zack.css">
 </head>
 <body>
 <div class="container container-main">
  <header>
   <nav class="navbar treecrumb pull-left nav-open" role="navigation"></nav>
   <div class="clearfix">
   </div>
   <a href="/" class="brand hidden-xs">
    <img src="/img/logo-CH.svg" onerror="this.onerror=null; this.src='/img/logo-CH.png'">
    <h1>data.admin.ch - Linked Data Pilot</h1>
   </a>
  </header>
  <nav class="nav-main yamm navbar" id="main-navigation" role="navigation">
<section class="nav-mobile nav-open">
    <div class="table-row nav-open">
      <div class="nav-mobile-header">
        <div class="table-row">
          <span class="nav-mobile-logo">
            <img src="/img/swiss.svg" onerror="this.onerror=null; this.src='/img/swiss.png'" alt="Confederatio Helvetica">
          </span>
          <h1>
            <a href="#">data.admin.ch - Linked Data Pilot</a>
          </h1>
        </div>
      </div>
    </div>
  </section>
  </nav>

  <div class="container-fluid">
   <div class="row">
     <div class="zack-query-box">
      <div class="col-sm-12 col-md-6">
        <form class="zack-query-form form-search" action="javascript:document.getElementById('query').blur();">
            <h2 class="sr-only">Searchterm</h2>
            <label for="search-field" class="sr-only">Searchterm</label>
            <input autofocus id="query" class="zack-query-input zack-big form-control search-field " type="text" placeholder="Searchterm">
            <button class="icon icon--search icon--before"></button>
        </form>
      </div>
<!--      <div class="col-sm-6">
       <div id="level-filter" data-filterable="=" data-predicate="http://www.w3.org/1999/02/22-rdf-syntax-ns#type" data-value="http://www.geonames.org/ontology#A.ADM3" data-named-node class="filterable" onclick="app.search.addFilter(this)">Municipality</div>
       <div id="level-filter" data-filterable="=" data-predicate="http://www.w3.org/1999/02/22-rdf-syntax-ns#type" data-value="http://www.geonames.org/ontology#A.ADM2" data-named-node class="filterable" onclick="app.search.addFilter(this)">District</div>
       <div id="level-filter" data-filterable="=" data-predicate="http://www.w3.org/1999/02/22-rdf-syntax-ns#type" data-value="http://www.geonames.org/ontology#A.ADM1" data-named-node class="filterable" onclick="app.search.addFilter(this)">Canton</div>
       </div>

-->
     </div>
    </div>
    <div class="row">
     <div class="col-sm-12 col-md-12">
      <div id="filter-container" class="zack-filter">
      </div>
     </div>
    </div>
    <div class="row">
     <div class="col-sm-12 col-md-12">
      <div class="zack-content">
      <div class="zack-result-list">
        <div id="scrollArea" class="clusterize-scroll">
          <div id="contentArea" class="clusterize-content">
            <div class="clusterize-no-data">Loading dataâ€¦</div>
          </div>
        </div>
      </div>
      </div>
     </div>
    </div>
    <div class="row">
     <div class="col-sm-12 col-md-12">
      <div class="zack-overview">
        <div class="col-sm-3">
          <span id="count" class="zack-count zack-big"></span> <i>Results</i>
        </div>
     </div>
     </div>
    </div>
   </div>

  <footer>
   <div class="container-fluid">
    <h3>&nbsp;</h3>
    <hr class="footer-line visible-xs">
    <img class="visible-xs" src="/img/logo-CH.svg" onerror="this.onerror=null; this.src='/img/logo-CH.png'" alt="">
   </div>

   <address>
    <span class="hidden-xs pull-left">geo.admin.ch - Linked Data</span>
    <nav class="pull-right">
     <ul>
       <li><a target="_blank" href="//www.admin.ch/gov/en/start/terms-and-conditions.html">Disclaimer</a></li>
     </ul>
    </nav>
   </address>
  </footer>

  </div>


 <div class="text-center small">Powered by <a href="//github.com/zazuko/trifid" target="_blank">Trifid</a> & <a href="//github.com/zazuko/zack-search" target="_blank">Zack Search</a></span>
<script src="zack.min.js"></script>
<script>

var boundariesRenderer = {}

boundariesRenderer.init = function (metadata) {
}

boundariesRenderer.renderResult = function (page, subject) {
  var rendering = ''

  var link = subject.toString()
  var titleString = subject.toString()

  var titlePrefix = ''
  if (page.match(subject, 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type', 'https://gont.ch/PoliticalMunicipality').toArray().shift()) { titlePrefix = "Municipality" }

  var bfsNumber = page.match(subject, 'http://purl.org/dc/terms/identifier').toArray().shift()
  if (bfsNumber) {var bfsNumberString = bfsNumber.object.toString()}

  var versions = page.match(subject, 'https://gont.ch/municipalityVersion').toArray()
  var versionsSpan = ''
  if (versions) {
      versions.forEach(function(ver, ind){
          versionsSpan = versionsSpan + '<span>' + (ind ? ', ' : '') + '<a href="' + ver.object.toString() + '">' + ver.object.toString().split("/")[4] + '</span>'
      })
  }

  rendering = '<div class="zack-result"><div class="result-main col-md-6 col-sm-6 col-xs-6"><article class="search-result">' +
              '<a href="' + link + '"><span>' + titlePrefix + '</span>' +
              '<h4>' + titleString + '</h4></a>' +
              '</div>' +
              '<div class="result-detail col-md-3 hidden-sm hidden-xs">' +
              '<span>BFS #' + bfsNumberString + '</span>' +
              '</div>' +
              '<div class="result-detail col-md-3 col-sm-6 col-xs-6">' +
              'Versions: ' + versionsSpan + '' +
              '</div>' +

              '</article></div>'

  return rendering
}

boundariesRenderer.postRender = function () {
}


  var options = {
    endpointUrl: '/query',
    filterContainer: 'filter-container',
    resultTypes: ['https://gont.ch/Municipality'],
    resultList: {
      renderer: boundariesRenderer,
      pageSize: 20,
      preload: 80
    },
    queries: {
      adminMeta: 'PREFIX : <http://voc.zazuko.com/zack#> PREFIX  rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX  text: <http://jena.apache.org/text#> PREFIX  rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX  skos: <http://www.w3.org/2004/02/skos/core#> PREFIX  xsd: <http://www.w3.org/2001/XMLSchema#> CONSTRUCT { _:b0 :numberOfResults ?count.  _:b0 :queryStart "0".  _:b0 :queryEnd "0".  } WHERE { { SELECT (COUNT(?sub) as ?count) { ${textmatch} ${filters} } } }',
      adminFulltextPart: '?sub <https://gont.ch/municipalityVersion> ?subver. ?subver <https://gont.ch/shortName> ?name. FILTER( CONTAINS(LCASE(?name), LCASE("${searchString}")))',
    },
    endpoints: {
      '/query': {
        queries: {
          search: 'fusekiResultset',
          count: 'adminMeta',
          textmatch: 'adminFulltextPart'
        }
      }
    },
    plugins: []
  }

  window.app = new Zack(options)

  window.app.init().catch(function (err) {
    console.error(err)
  })

</script>
</body>
</html>
